/*
 * digital_io.c
 */
#include "board.h"

#include "digital_io.h"

// Implementação da função pinMode
void pinMode(uint16_t pin, uint8_t mode) {
    GPIO_TypeDef* gpio_port = gpio_port_table[pin];
    uint16_t gpio_pin = gpio_pin_table[pin];

    GPIO_InitTypeDef GPIO_InitStruct = {0};

    GPIO_InitStruct.Pin = gpio_pin;
    GPIO_InitStruct.Mode = mode == INPUT ? GPIO_MODE_INPUT : GPIO_MODE_OUTPUT_PP;
    GPIO_InitStruct.Pull = GPIO_NOPULL;
    GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;

    HAL_GPIO_Init(gpio_port, &GPIO_InitStruct);
}

int digitalRead(int pin) {
    GPIO_PinState state;

    GPIO_TypeDef* gpio_port = gpio_port_table[pin];
    uint16_t gpio_pin = gpio_pin_table[pin];

    state = HAL_GPIO_ReadPin(gpio_port, gpio_pin);

    return (state == GPIO_PIN_RESET ? LOW : HIGH);
}

void digitalWrite(int pin, int value) {
    GPIO_PinState state;

    GPIO_TypeDef* gpio_port = gpio_port_table[pin];
    uint16_t gpio_pin = gpio_pin_table[pin];

    state = (value == LOW ? GPIO_PIN_RESET : GPIO_PIN_SET);

    HAL_GPIO_WritePin(gpio_port, gpio_pin, state);
}
